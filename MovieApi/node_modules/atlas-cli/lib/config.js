import fs from 'fs';
import homedir from 'homedir';

const CONFIGURATION_FILE = `${homedir()}/.atlasrc`;

const loadConfiguration = async () => {
  return new Promise((resolve, reject) => {
    fs.readFile(CONFIGURATION_FILE, 'utf-8', (err, data) => {
      if (err) {
        reject(err.message);
        return;
      }
      const json = JSON.parse(data);
      resolve(json);
    });
  });
};

const saveConfiguration = async (key, value) => {
  let conf;
  try {
    conf = await loadConfiguration();
  } catch (e) {
    conf = {};
  }

  conf[key] = value;
  const configString = JSON.stringify(conf, null, 2);

  return new Promise((resolve, reject) => {
    fs.writeFile(CONFIGURATION_FILE, configString, (err) => {
      if (err) {
        reject(err.message);
        return;
      }
      resolve();
    });
  });
};

export {
  CONFIGURATION_FILE,
  loadConfiguration,
  saveConfiguration,
};
